#include "engine.h"

texture *font = NULL;

struct fontchar
{
	int x, y;
	int dx;
};

//height is always 64
fontchar fontmap[] = {
	{ 7  , 0,   17 }, /*!*/
	{ 26 , 0,   24 }, /*"*/
	{ 52 , 0,   30 }, /*#*/
	{ 94 , 0,   32 }, /*$*/
	{ 128, 0,   55 }, /*%*/
	{ 185, 0,   43 }, /*&*/
	{ 230, 0,   14  }, /*'*/
	{ 246, 0,   24 }, /*(*/
	{ 272, 0,   23 }, /*)*/
	{ 297, 0,   32 }, /***/
	{ 331, 0,   40 }, /*+*/
	{ 373, 0,   18 }, /*,*/
	{ 393, 0,   22 }, /*-*/
	{ 417, 0,   16 }, /*.*/
	{ 435, 0,   25 }, /*/*/
	{ 462, 0,   32 }, /*0*/
	{ 0  , 71,  30 }, /*1*/
	{ 32 , 71,  32 }, /*2*/
	{ 173, 71,  31 }, /*3*/
	{ 206, 71,  33 }, /*4*/
	{ 241, 71,  32 }, /*5*/
	{ 275, 71,  33 }, /*6*/
	{ 310, 71,  33 }, /*7*/
	{ 345, 71,  32 }, /*8*/
	{ 379, 71,  32 }, /*9*/
	{ 413, 71,  18 }, /*:*/
	{ 433, 71,  20 }, /*;*/
	{ 455, 71,  38 }, /*<*/
	{ 0  , 142, 39 }, /*=*/
	{ 148, 142, 39 }, /*>*/
	{ 189, 142, 29 }, /*?*/
	{ 220, 142, 51 }, /*@*/
	{ 273, 142, 38 }, /*A*/
	{ 313, 142, 35 }, /*B*/
	{ 350, 142, 36 }, /*C*/
	{ 388, 142, 40 }, /*D*/
	{ 430, 142, 33 }, /*E*/
	{ 465, 142, 32 }, /*F*/
	{ 0  , 213, 38 }, /*G*/
	{ 40 , 213, 37 }, /*H*/
	{ 79 , 213, 23 }, /*I*/
	{ 104, 213, 24 }, /*J*/
	{ 130, 213, 37 }, /*K*/
	{ 169, 213, 32 }, /*L*/
	{ 310, 213, 42 }, /*M*/
	{ 354, 213, 37 }, /*N*/
	{ 393, 213, 41 }, /*O*/
	{ 436, 213, 34 }, /*P*/
	{ 472, 213, 41 }, /*Q*/
	{ 0  , 284, 39 }, /*R*/
	{ 41 , 284, 34 }, /*S*/
	{ 77 , 284, 37 }, /*T*/
	{ 116, 284, 37 }, /*U*/
	{ 155, 284, 38 }, /*V*/
	{ 195, 284, 53 }, /*W*/
	{ 250, 284, 36 }, /*X*/
	{ 288, 284, 37 }, /*Y*/
	{ 327, 284, 34 }, /*Z*/
	{ 363, 284, 23 }, /*[*/
	{ 388, 284, 26 }, /*\*/
	{ 416, 284, 21 }, /*]*/
	{ 439, 284, 41 }, /*^*/
	{ 0  , 355, 36 }, /*_*/
	{ 203, 213, 23 }, /*`*/
	{ 38 , 355, 30 }, /*a*/
	{ 70 , 355, 33 }, /*b*/
	{ 105, 355, 29 }, /*c*/
	{ 136, 355, 31 }, /*d*/
	{ 169, 355, 32 }, /*e*/
	{ 203, 355, 24 }, /*f*/
	{ 229, 355, 31 }, /*g*/
	{ 262, 355, 32 }, /*h*/
	{ 296, 355, 14  }, /*i*/
	{ 312, 355, 20 }, /*j*/
	{ 334, 355, 32 }, /*k*/
	{ 369, 355, 14  }, /*l*/
	{ 385, 355, 47 }, /*m*/
	{ 434, 355, 32 }, /*n*/
	{ 468, 355, 33 }, /*o*/
	{ 0  , 426, 33 }, /*p*/
	{ 35 , 426, 31 }, /*q*/
	{ 68 , 426, 24 }, /*r*/
	{ 94 , 426, 28 }, /*s*/
	{ 124, 426, 23 }, /*t*/
	{ 149, 426, 31 }, /*u*/
	{ 182, 426, 32 }, /*v*/
	{ 216, 426, 44 }, /*w*/
	{ 262, 426, 31 }, /*x*/
	{ 295, 426, 32 }, /*y*/
	{ 329, 426, 28 }, /*z*/
	{ 359, 426, 28 }, /*{*/
	{ 496, 426, 18 }, /*|*/
	{ 389, 426, 28 }, /*}*/
	{ 419, 426, 39 }, /*~*/
};

void drawstring(const char *str, int x, int y, int dx, int dy, float r, float g, float b, float a)
{
	settexture(font);

	glColor4f(r, g, b, a);
	glPushMatrix();
	glTranslatef(x, y, 0);
	x = y = 0;
	glBegin(GL_QUADS);

	do
	{
		if(str[0] == '\n')
		{
			y += 64;
			x = 0;
			continue;
		}
		if(str[0] == ' ')
		{
			x += 32;
			continue;
		}
		if(str[0] == '\t')
		{
			x += 128;
			x -= x % 128;
			continue;
		}

		fontchar &def = fontmap[str[0] - '!'];
		if(x + def.dx > dx)
		{
			x = 0; y += 64;
			if(y >= dy)
				break;
		}

		glTexCoord2f(def.x / 512.f, def.y / 512.f);
		glVertex2i(x, y);
		glTexCoord2f((def.x + def.dx) / 512.f, def.y / 512.f);
		glVertex2i(x + def.dx, y);
		glTexCoord2f((def.x + def.dx) / 512.f, (def.y + 64) / 512.f);
		glVertex2i(x + def.dx, y + 64);
		glTexCoord2f(def.x / 512.f, (def.y + 64) / 512.f);
		glVertex2i(x, y + 64);

		x += def.dx;
	} while(*(++str));

	glEnd();
	glPopMatrix();
}
